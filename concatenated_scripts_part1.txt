# Concatenated Project Code - Part 1 of 3
# Generated: 2025-05-12 16:05:28
# Root Directory: /Users/gianmariatroiani/Documents/misophonia-companion-v3
================================================================================

# Directory Structure
################################################################################
├── .DS_Store
├── .gitignore
├── README.md
├── eslint.config.js
├── index.html
├── js-requirements.md
├── netlify/
│   └── functions/
│       ├── _utils.js
│       ├── chat.js
│       ├── rag.js
│       ├── rag_before_copying_python_logic.js
│       ├── research.js
│       └── search.js
├── netlify.toml
├── package.json
├── public/
│   ├── icon-192.png
│   ├── icon-512.png
│   ├── manifest.json
│   └── vite.svg
├── requirements.txt
├── scripts/
│   ├── docling_batch_convert_with_metadata.py
│   ├── ingest.js
│   ├── migrate_to_supabase.js
│   ├── old/
│   ├── optimized_batch_process_gian_v1.py
│   ├── process_research_metadata.py
│   ├── processed_files.json
│   ├── rag_web_app_v10.py
│   ├── resilient_batch_embedding_generator_gian_v1.1.py
│   ├── templates/
│   │   ├── index.html
│   │   ├── rag_web_interface_gian_v1 copy.py
│   │   └── rag_web_interface_gian_v1.py
│   └── test_vector_search.py
├── server/
│   ├── index.js
│   └── package.json
├── src/
│   ├── App.css
│   ├── App.jsx
│   ├── RagAssistant.jsx
│   ├── TermsModal.jsx
│   ├── assets/
│   │   ├── bot-avatar.png
│   │   ├── react.svg
│   │   └── user-avatar.png
│   ├── index.css
│   └── main.jsx
└── vite.config.js


================================================================================


################################################################################
# File: scripts/processed_files.json
################################################################################

[
  "Kumar 2017 The Brain Basis for Misophonia.txt",
  "Guetta 2025 Misophonia is related to stress but not directly wtih traumatic stress.txt",
  "Kashihara 2017 Attentive Observation is Essential for the Misattribution of agency to self-performance.txt",
  "Godpole 2025 A Young Woman with Misophonia Leading to Unwanted Sexual Arousal.txt",
  "Rinaldi 2022 Autistic traits, emotion regulation, and sensory sensitivities in children.txt",
  "Hodges 2014 Medical Education Meet Foucault.txt",
  "Mollman 2024 a conceptual framework on body representations.txt",
  "Kinney 2024 Neurodiversity_and_Epistemic_Justice.txt",
  "Langguth 2024 Tinnitus Clinical Insights.txt",
  "aksan et al. 2023 Evaluating Traumatic Event Scoring Schemas.txt",
  "Cerliani 2015 Increased functional connectivity between subcortical and cortical resting-state networks in autism spectrum disorder.txt",
  "Kornelsen 2023 Structural differences in the cortex of individuals who experience the autonomous.txt",
  "Trumbull 2023 Using a standardized sound set to help characterize misophonia.txt",
  "Aryal 2023 Pre Proof Awareness and Perspectives of Audiologists on Assessment and Management of Misophonia in India.txt",
  "Berger 2024 Human Insula Neurons respond to Simple Sounds During Passive Listening.txt",
  "Sajid 2021 Paradigm shifting from bio medical to bio psycho social and role of medical social work.txt",
  "Soler et al 2024 Parent-young person lived experience of sensory dysregulation in children with tic disorders  a qualitative study.txt",
  "Stalias Mantzikos 2023 Early Maladaptive Schemas in Misophonia.txt",
  "McGeoch and Rouw 2020 How everyday sounds can trigger strong emotions asmr misophonia and the feeling of wellbeing.txt",
  "Rosenthal 2023 Editorial Final.txt",
  "Munoz 2025 Assessment of auditory conditions in misophonia treatment research a scoping review.txt",
  "Sonuga Barke and Thapar 2021 The Neurodiversity Concept.txt",
  "Kazemi et al Effects of Cognitive Behavioral Therapy for Misophonia.txt",
  "Andermane 2024 A symptom network model of misophonia  From heightened sensory sensitivity to clinical.txt",
  "LeDoux 2020 Seeing Consciousness Through the lens of Memory.txt",
  "O_Connor 2013 How has neuroscience affected lay understandings of personalhood a review of the evidence.txt",
  "Jager Inge 2022 Synopsis and Qualitative Evaluation of a Treatment Protocol Group CBT.txt",
  "Taschereau dash Domouchel 2021 Putting the mental back Notes.txt",
  "Wunrow 2024 Selective noise cancelling application for misophonia treatment.txt",
  "Simner 2023 Misophonia  self\u2010harm and suicidal ideation.txt",
  "Oszczapinska et al 2024 The impact of disgusting sounds on pupil diameter.txt",
  "Journal of Hearing Science.txt",
  "aazh-et-al-2024-a-preliminary-analysis-of-the-clinical-effectiveness-of-audiologist-delivered-cognitive-behavioral.txt",
  "Ahmmed and Vijayakumar 2024 Distinguishing Between Hyperacusis and Misophonia in Children with auditory processing disorder.txt",
  "Katikar et al 2025 Sensory processing in autism spectrum disorder insights into misophonia and hyperacusis in a pediatric population.txt",
  "Dwyer 2023 Haibutation of auditory responsesin young autistic and neurotypical hildren.txt",
  "Jager 2021 EMDR therapy for misophonia a pilot study of case series.txt",
  "Agnieszka 2023 Increased misophonia in self reported Autonomous sensory meridian response.txt",
  "Sharp 2024 For Whom the Bell Tolls.txt",
  "Patro et al 2025 Investigating Neurophysiological, perceptual, and cognitive mechanicisms in misophonia.txt",
  "Begenen 2023 A comparison of clinical features and executive functions between patients with obsessive compulsivedisorder with and without misophonia.txt",
  "Frank  2019 Inattention in Misophonia.txt",
  "Guetta 2020 Development and psychometric exploration of a semi-structured clinical interview for misophonia.txt",
  "Forester 2024 Back to the future progressing memory research in eating disorders.txt",
  "Dibb and Golding 2023 A Longitudinal Investigation of quality of life and negative emotions in misophonia.txt",
  "Meltzoff 2007 Like Me.txt",
  "Pfeiffer 2022 Misophonia in Children and adolescents a narrative review translation from German.txt",
  "Heller 2025 Reassigning sources of misophonic trigger sounds to change their unpleasantness_ Testing alternative mechanisms with a new set of movies, paintings, and words.txt",
  "Bernstein 2013 A brief course of cognitive behavioral therapy for the treatment of misophonia.txt",
  "Kidd and Carel 2017 Epistemic Injustice and Illness.txt",
  "Mahzouni et al 2024  Positive attributable visual sources attenuate the impact of trigger sounds in misophonia.txt",
  "Ghorbani 2023 The Mediating Role of Sensory Processing.txt",
  "Makani 2024 Hyperacusis in Tinnitus Individuals is Associated with Smaller Gray Matter.txt",
  "Armstrong 2023 Factors associated with internalizing and externalizing symptoms in a clinical sample of youth with misophonia.txt",
  "Newby 2024 Sensory processing in children with Paediatric Acute\u2010onset Neuropsychiatric Syndrome (1).txt",
  "Ay 2024 The mediating role of anxiety in the relationship between misophonia and quality of life.txt",
  "Kumar 2021 Motor Basis.txt",
  "Fricker 2017 Evolving Concepts of EI_pre-publication.txt",
  "Cavana and Seri (2015) Misophonia Current Perspectives.txt",
  "Chaves Baldini 2024 Existential concerns in psychopathology  a transdiagnostic network analysis existential concerns in psychopathology.txt",
  "Lewin 2021 Transdiagnostic cognitive behavioral therapy for misophonia in youth methods for a clinical trial and four pilot cases.txt",
  "Rappoldt 2023 Effectiveness of an innovative treatment protocol for misophonia in children and adolescents.txt",
  "Jacobs 2023 Threat Perception Emotion Review.txt",
  "Aryal 2023 Auditory Cortical Functioning in Individuals with Misophonia.txt",
  "Longhurst 2007 using the body as a instrument of research.txt",
  "Heller et al 2025 Reassigning sources of misophonic trigger sounds to change their unpleasantness.txt",
  "Accardo 2024 Valuing Neurodiversity on Campus.txt",
  "Fierro 2024 Psychometric properties of a self-perception questionnaire for adults with suspected misophonia preprint.txt",
  "Dozier 2024 Safe and Sound Protocol with Brief Therapy for Misophonia A Pilot Study.txt",
  "Timms 2022 Auditory symptoms and autistic spectrum disorder a scoping review and recommendations.txt",
  "Natalini 2024 Megacognitive interpersonal therapy for Misophonia Single Case Study.txt",
  "K\u0131l\u0131c\u0327 Cengiz 2021 The Prevalence and Characteristics of misophonia in ankara turkey.txt",
  "Aazh 2023 Psychometric Evaluation of the Hyperausis Impact Questionaniare.txt",
  "Webb 2022 B Blockers for the treatment of misophonia and misokinesia.txt",
  "The neurobiology of misophonia and implications for novel, neuroscience-driven interventions.txt",
  "Taschereau-Dumouche 2022 Putting the mental back in mental disorders.txt",
  "Engel 1977 The Need for a New Medical Model A Challenge for Biomedicine.txt",
  "Lynch 2023 Introduction to the Special Issue on Covid 19.txt",
  "Orloff 2023 Curation of FOAMS A free Open Access Misophonia Stimuli Database.txt",
  "Bagrowska 2022 Do they make these sounds to hurt me the mediating role of emotion regulation,.txt",
  "Smith et al 2021 Taking knowledge production seriously in responsible research and innovation (1).txt",
  "Neacsiu 2024 An experimental examination of neurostimulation and cognitive restructuring as potential components for misophonia interventions.txt",
  "Karupaiah and Prabhu 2025 Auditory Brainstrem Response Patterns in Misophonia A Comparative Study.txt",
  "O_Conner 2025 The skater s ear  a sensuous complexity of skateboarding sound.txt",
  "Siepsiak 2023 Misophonia in Children and Adolescents.txt",
  "Ferrer-Torres 2022 Misophonia a Systematic Review of Current and Future Trends in this Emerging Clinical Field.txt",
  "Norena 2023 Civilisation of manners and misophonia.txt",
  "Berg 2019 Evidence Based Practice in psychology Fails to be Tripartite A Conceptual Critique of the Scientocentrism.txt",
  "Guzick 2022 Clinical characteristics, impairment, and psychiatric morbidity in102 youth with misophonia.txt",
  "Education and Occupation in The Misophonia Podcast.txt",
  "Kook et al 2024 Quality of Life among youth with misophonia.txt",
  "Musicality Misophonia Sensitivity and Responsiveness to Misopho.txt",
  "Smees 2024 Dissociable effects of hyperacusis and misophonia severity imply different mechanisms of decreased sound tolerance.txt",
  "Tyson 2023 Undergrad The Relationship Between Coping Behaviors and Misophonia Symptom.txt",
  "Bagrowska 2022 Do they make these sounds to hurt me (no notes).txt",
  "Ringer 2023  That sounds awful  Does sound unpleasantness modulate the mismatch.txt",
  "ASMR 2023 Review.txt",
  "Schroder 2013 Misophonia Diagnostic Criteria for a New Psychiatric Disorder.txt",
  "Mednicoff  2023 Misophonia Reactions in the General population.txt",
  "Cederroth Christopher 2019 Editorial Towards an understanding of tinnitus heterogeneity.txt",
  "Aryal  2023 Auditory Brainstem Functioning in Individuals with Misophonia.txt",
  "Horsfall 2024 Misophonia Development from Onset to College Age.txt",
  "LeDoux 2021 As soon as there was life, there was danger.txt",
  "Carel and Kidd 2017 Epistemic Injustice In Medicine and Healthcare.txt",
  "Edelstein 2020 context influences how individuals with misophonia respond to sounds.txt",
  "Raymond 2023 MisoQuest_Paper_Preprint.txt",
  "Cavanna 2014 What is misophonia and how can we treat it.txt",
  "Gerlus 2025 Abstract.txt",
  "Robinson 2023 The lived experiences of people with misophonia.txt",
  "Lorenzatti 2023 Aphantasia a Philosophical approach.txt",
  "Guzick et al 2024 Internet based parent led cognitive behavioral therapy for autistic youth with anxiety related disorders.txt",
  "Sanchez 2017 Familial misophonia.txt",
  "Siepsiak and Dragan 2019 Misophonia A Review of Research Results and Theoretical Concepts.txt",
  "Aazh and Kula 2024 The Sound Sensitivity Symptoms Questionnaire Version 2.0.txt",
  "Abramovitch 2024 A neuopsychological study of misophonia.txt",
  "Kevin 2023 Neurodiversity and autism between disability and difference preprint.txt",
  "Fricker-2013-Epistemicjusticecondition.txt",
  "Moscovici Notes Toward a Description of Social Representations.txt",
  "AAzh 2023 Commentary on Consensus Definition.txt",
  "Renaud 2024 Student_s Self Reported Experience of Soundscape.txt",
  "Rosenthal 2022 Phenotyping misophonia Psychiatric disorders and medical health correlates.txt",
  "Wu (2014) Misophonia Incidence Phenomenology, and Clincial Correlates in an undergraduate student sample.txt",
  "Dacremont 1995 Spectral composition.txt",
  "Webb 2024 Steriods for Misophonia.txt",
  "Johnson (1993) Source Monitoring.txt",
  "Eldesouky and Gross 2019 Emotion Regulation Goals an Individual difference perspectives.txt",
  "Trenholm Jensen 2022 Beyond tingles an exploratory qualitative study of autonomous sensory meridian response asmr.txt",
  "Daniels Emily 2020 Severity of misophonia symptoms worse cognitive control.txt",
  "howlett 2023 Investigating Self report and neuropsychological assessments of cognitive flexibility in people with and without persistent pain.txt",
  "McKee et al 2024 sound-sensitivities-in-the-quiet-environment-implications-and-strategies-for-management.txt",
  "Zai 2022 Misophonia A Detailed Case Series and Literature Review.txt",
  "Hayes 2023 Psychometric evaluation and misophonic experience.txt",
  "Brown 2019 Why Study the History of Neuroscience.txt",
  "Simner 2022 Attention flexibility and imagery in misophonia.txt",
  "mohebian 2023 the_analysis_of_the_cognitive_function_parameters.6.txt",
  "Grayless 2021 Assessment and Management Case Study.txt",
  "Poldoly 2025 A randomized controlled trial evaluating an mHealth intervention for anger-related cognitions in misophonia.txt",
  "Berger 2023 A Social Cognition Perspective on Misophonia.txt",
  "Lawson Rebecca 2017 Adults with Autism overestimate the volatility of the sensory environment.txt",
  "Siepsiak 2020 Development and Psychometric Properties of MisoQuest.txt",
  "Claiborn et al 2020 Self-Identified Misophonia Phenomenology, Impact and Clinical Correlates.txt",
  "Kotler 2022 First Few seconds for flow a comprehensive proposal of the neurobiology and neurodynamics of state onset.txt",
  "Norris Jordan 2022 Toward a Multi-Dimensional Understanding of Misophonia.txt",
  "Chalmers 1995 Facing Up to the Problem of Consciousness.txt",
  "Yektatalab 2022 The Prevalence of Misophonia and its relationship with OCD.txt",
  "Spencer 2023 Mindfulness and cognitive emotion regulation in pediatric misophonia.txt",
  "Siepsiak 2023 Does context matter in misophonia a multi method experiemental investigation.txt",
  "Jastreboff Pawel 2001 Components of decreased sound tolerance.txt",
  "Smees 2022 The Parent completed Glasgow Sensory Questionnaire Exploring Children_s Sensory Sensitivities and Their Relationship to Well being.txt",
  "Fricker Virtue.txt",
  "Mattson 2023 A Systematic Review of treatments for misophonia.txt",
  "Grossini 2022 Misophonia Analysis of the neuroanatomic patterns at the basisof psychiatric symptoms.txt",
  "Hoy 1991 A History of consciousness from Kant and Hegel to Derrida and Foucault.txt",
  "Cromby 2007 Integrating social science with neuroscience.txt",
  "deGee et al 2024 Sound evoked pupil dilation quantifies misophonia symptoms.txt",
  "Yamazawa 2025 A study on the prevalence of hyperacusis among university students.txt",
  "rose-2001-the-politics-of-life-itself.txt",
  "Wingen 2022 Caution, Preprint Brief Explanations Allow Nonscientists to Differentiate.txt",
  "Aryal 2022 Misophonia Prevalence, impact and co-morbidity among Mysore University Students in India.txt",
  "Hamida 2024 Guidance to investigate University students_ responses to sound.txt",
  "Gregory 2023 Targeting Beliefs and behaviors in misophonia.txt",
  "Radoilska and Foreman 2023 Epistemic Justice is both a legitimate and an integral goal of psychiatry.txt",
  "Williams 2023 Prevalence of decreased sound tolerance.txt",
  "O_Reilley et al 2025 Examining Physiological Responses to Misophonic Triggers.txt",
  "Feinberg 2020 Phenomenal Consciousness and Emergence Eliminating the Explanatory Gap.txt",
  "Watson 2022 Investigation of a Misophonia and Fluid Intelligence Relationship.txt",
  "Dixon et al 2024 Emotion Dysregulation in misophonia findings from a nationally representative sample.txt",
  "Lau 2022 The Mnemonic Basis of Subjective Experience.txt",
  "Cowan et al. 2021 Misophonia A Psychological Model and Proposed Treatment.txt",
  "Paul 2005 Perception and Production of Prosody by Speakers with autism spectrum disorder.txt",
  "Grasswick 2017 Epistemic Injustice in Science.txt",
  "Guetta 2022 Examining emotional functioning in misophonia the role of affective instability.txt",
  "Vijayakumar 2025 A Retrospective Study of Audiological Characteristics of Hyperacusis versus Misophonia in children with auditory processing disorder.txt",
  "Erturk 2023 Examining the correlation between misophonia symptoms and autistic traits in general population.txt",
  "Tomasello 2003 What Makes Human Cognition Unique.txt",
  "Association Prevalence of Misophonia in adolescents and adults across the globe.txt",
  "Kumar 2014 Misophonia a disorder of emotion processing of sound.txt",
  "Ecker 2022 Psychotherapies for a new humanism.txt",
  "Edelstein 2013 Miosphonia Physiological investigations.txt",
  "Ash (2022) Mimicry in misophonia Manuscript Preprint.txt",
  "Zabelina 2015 Creativity and sensory gating indexed by the P50.txt",
  "Ward 2022 The Relationship Between Self-Reported Misophonia Symptoms and Auditory Aversive Generalized Leaning A Preliminary Report.txt",
  "Magrini 2023 Acoustic Quality of the External Environment.txt",
  "Krog 2024 Preliminary validation of the Norwegian version of the Berlin Misophonia-1.txt",
  "Qin 2024 Development and validation of the perceived restorative soundscape scale for children.txt",
  "Dinishak 2019 Autism, aspect perception and neurodiversity.txt",
  "INVER_logo_lockup_cmyk_fullcolor.txt",
  "Regencia et al 2025 Level of depression anxiety and stress among emerging adults in the Phillipines.txt",
  "Fishkin 2023 Charlie Haden_s Earplugs (1).txt",
  "Shan et al 2024 Network analysis of misophonia symptoms using the Duke Misophonia Questionnaire.txt",
  "Silva 2024 Assessing Misophonia in Young Adults Prevalence and Psychometric Validation of Misoquest.txt",
  "Guetta Rachel 2022 Examining Emotional Functioning in Misophonia.txt",
  "Jastreboff 2023 The neurophysiological approach to misophonia theory and treatment.txt",
  "Siepsiak  2019 Misophonia A Review of Research Results and Theoretical Concepts.txt",
  "Dixon 2023 Public Awareness of Misophonia in US adults a Population based study.txt",
  "Savard Marie-Anick Specificity of Affective Response Depends on Trigger Identification.txt",
  "lin 2024-brain-circuits-in-autonomous-sensory-meridian-response-and-related-phenomena.txt",
  "Cobbaert 2023 Eating Disorders and Neurodivergence A Stepped Care Approach.txt",
  "Aazh 2023 The Effectiveness of Unguided Internet-Based Cognitive Behavioral Therapy for Tinnitus and Misophonia.txt",
  "Smit 2023 A genome-wide association study of a rage-related misophonia symptom and the genetic link with audiological traits, psychiatric disorders, and personality.txt",
  "Jastreboff 2014 Treatments for Decreased Sound Tolerance Hyperacusis and misophonia.txt",
  "Fagelson 2022 Tinnitus and Traumatic Memory.txt",
  "Molapour 2021 Seven Computations of the social brain.txt",
  "Tziovara 2024 patients perception of sound and noise dimensions in the dental clinic environment.txt",
  "Johnson (1981) Reality monitoring.txt",
  "Chen Zhu 2022 How to Integrate the soundscape resource.txt",
  "Kumar 2023 Mimicry in Misophonia.txt",
  "Barahmand Ursha 2012 Implications of perceived physical and social aspects of the environment.txt",
  "Pan 2022 Treatment of Misophonia with Risperidone in a Patient with Autism Spectrum Disorder.txt",
  "Turnock 2022 Understanding Stigma in Autism.txt",
  "Vuoskoski 2024-the-aversive-musical-experience-scale-(ames)-measuring-individual-differences-in-the-intensity.txt",
  "Kaufman 2022 Opening a Door into the Riddle of Misophonia, Sensory over-responsiveness and pain.txt",
  "Mahady 2023 What is autonomous sensory meridian response ASMR A narrative revie and comparative analysis of related phenomena.txt",
  "Kula 2025 Hyperacusis and Misophonia Measures Dissertation.txt",
  "Schneider 2017 Case study A novel application of mindfulness and acceptance based.txt",
  "Rosenthal 2023 Treatment of Misophonia.txt",
  "Kula 2023 Hyperacusis and Misophonia a Systematic Review of Psychometric Measures.txt",
  "Du Plessis 2009Ethics of Knowledge UNESCO.txt",
  "Rosenthal 2022 phenotyping misophonia.txt",
  "Wang 2022 The tie that binds temporal coding adaptive emotion.txt",
  "Rosenthal 2022 Misophonia Symptoms Comorbidities and Perspectives of Intervention.txt",
  "Sabah 2024 UFHRD-2024-Abstract-Book (1).txt",
  "Berger et al 2025 human insula neurons respond to simple sounds during passive listening.txt",
  "Kazazis 2024 Triggering Misophonia  The Importance of Spectral Information  Temporal Information  and Action Identification.txt",
  "Wooley et al 2025 Recognizing Individual Variability in Misophonia Identifying Symptom Based Subgroups.txt",
  "McMahon 2024 The Unified protocol for transdiagnostic treatment of emotioanl disorders for misophonia.txt",
  "Johnson (1988) Reality monitoring an experimental phenomenological approach.txt",
  "Brandis Epistemology.txt",
  "Potgieter Iskra 2018 Misophonia A scoping Reiew of Research.txt",
  "Emilie_Schramer_poster.txt",
  "Kulik 1978 Frustration, Attribution of Blame, and Aggression.txt",
  "Colak et al 2021 Misophonic symptoms in non-psychotic psychiatric outpatients.txt",
  "Hansen 2021 Neural evidence for non-orofacial triggers in mild misophonia.txt",
  "Brennan 2023 Misophonia and Hearing Comorbidities.txt",
  "Jastreboff and Jastreboff (2002) Decreased Sound Tolerance and Tinnitus Retraining Therapy (TRT).txt",
  "Uglik-Marucha et al. (2023). Beyond sound irritation- cross-cultural evidence . . .  S-Five in a Polish sample. (2).txt",
  "Watson 2019 Prosody indexes both competence and performance.txt",
  "Papoulias 2021 material and epistemic precarity.txt",
  "Shafiq 2023 Hatred is a mindset triggered by stressful external events, negative personal.txt",
  "Tenesaca 2023 Neural_Correlates_of_Attention allocation versus sound habituation.txt",
  "Rappoldt et al 2-24 Psychometric Validation of the New Misophonia Screening List.txt",
  "Heller 2022 Identification of Everyday Sounds Affects Their Pleasantness.txt",
  "Ci Quek 2018 Misophonia in Singaporean Psychiatric Patients a Cross Sectional Study.txt",
  "LeDoux 2020 How does the nonconscious become conscious.txt",
  "Cassiello Robins 2020 A systematic review of Unified Protocol applications with adult populations.txt",
  "Scrutton 2017 Epistemic Injustice and Mental Illness.txt",
  "Abramovitch 2023 A neuropsychological study of misophonia.txt",
  "Monzel et al 2023 Aphantasia within the framework of neurodivergence.txt",
  "Murphy 2023 Alterations in attentinal processingin youth with misophonia.txt",
  "Henry 2022 Sound Tolerance Conditions Definitions and Clinical Management.txt",
  "Damis 2024 The role of implicit memory in the development and recovery from trauma.txt",
  "Dibb 2022 A Longitudinal investigation of quality of life and negative emotions in misophonia.txt",
  "Aryal 2023 Understanding Misophonia from an Audiological Perspective a Systematic Review.txt",
  "Smith 2022 Perceptions of Various Treatment Methodologies for Adults and Children with Misophonia.txt",
  "Wickie et al 2025 Social success in a noisy world.txt",
  "Shandiz et al 2025 The effectiveness of cathodal (tDCS) in right insula region and cognitive behavioral therapy in misophonia disorder.txt",
  "Translation Needed JSREP_Volume 44_Issue 205_Pages 523-612 (1).txt",
  "Papoulias 2021 material and epistemic precarity it_s time to talk about labour exploitation in mental health research.txt",
  "Radoilska 2020 distinguishing value neutrality.txt",
  "Samermit 2019 Cross Sensory Stimuli Modulate Reactions to Aversive Sounds.txt",
  "Neacsiu 2022 The neurobiology of misophonia and implications for novel, neuroscience driven interventions.txt",
  "Sakaraya 2022 Validity and Reliability Testing Study of the Turkish version of the misophonia scale.txt",
  "Schubert 2023 Making Up Misophonic People.txt",
  "Gowda 2023 Abstract A New Insomnia Phenotype Coronasomnia Misophonia Syndrome.txt",
  "Swanepoel 2017 how-evolutionary-thinking-can-help-us-to-understand-adhd.txt",
  "Cerliani 2020 Increased orbitofrontal connectivity in misophonia.txt",
  "Bowers et al 2014 Acceptance and commitment therapy versus progressive relaxation training for misophonia.txt",
  "Aryal 2024 Efferent Pathway Functioning.txt",
  "Schechter 2022 The unity of consciousness subjects and objectivity.txt",
  "Aldakhil and Shaik 2025 Misophonia in Autism A Systematic Review of prevalence, clinical features, and comorbidities.txt",
  "Jager 2020 Misophonia Phenomenology Comorbidity and demographics in a large sample.txt",
  "Madappally 2024 Do INdividuals with misophonia experience challenges with their auditory binaural interaction.txt",
  "Psychiatry Clin NeurosciSmith 2020 Recent advances in the application of predictive coding and active inference.txt",
  "Long 2018 Bottom up and top down factors differentially influence stimuls representations across large scale attentional networks.txt",
  "Chan 2023 The impact of mental health symptoms in children with Tinnitus and misophonia.txt",
  "Mufreze 2025 Beyond the Sound the role of the source.txt",
  "Jastreboff 2015 decreased sound tolerance hyperacusis, misophonia, diplacousis and polyacousis.txt",
  "Holohan 2023 Misophonia A Review of the Literature and Its Implications for the Social Work Profession.txt",
  "Ila 2023 Assessment of temporal auditory processing in individuals with misophonia.txt",
  "Ferrer-Torres 2022 On the lack of self-concept and social representation.txt",
  "Ozuer 2025 Understanding the misophonic experience a mixed method study.txt",
  "Savard 2025 Toward Cognitive Models of Misophonia.txt",
  "Sujeeth 2023 Estimation of Prevalence of Misophonia among High School students in India.txt",
  "Emotional Engagement to Music is Correlated with Enhanced Frisson.txt",
  "Sommerfeld 1989 The origins of Mother Blaming Historical Perspectives on Childhood and Mothering.txt",
  "Dibb and Golding 2023 Corrigendum A Longitudinal Investigation of quality of life and negative emotions in misophonia.txt",
  "Shan 2022 Misophobia handbook-comorbidity.txt",
  "Williams_2024_Dissertation_poster_Updated.txt",
  "Vitoratou 2020 Selective Sound Sensitivity Syndrome Scale S5.txt",
  "Clark and Chalmers (1998) The-Extended-Mind.txt",
  "Dozier 2015 Counterconditioning Treatment for Misophonia.txt",
  "BABCP Conference Abstract 2022.txt",
  "Casiello Robbins 2020 The Mediating Role of Emotion Regulation Within the Relationship Between Neuroticism and Misophonia A Preliminary Investigation.txt",
  "Williams 2022 Psychometric validation of a brief self report measure of misophonia symptoms and functional impairment The duke-vanderbilt misophonia screening questionnaire.txt",
  "Oh Et al 2025 Physiological Responses to Aversive and Non-aversive Audiovisual, Audio and Visual Stimuli.txt",
  "Rouw and Erfanian 2017 A Large Scale Study of Misophonia.txt",
  "Taschereau dash Domouchel 2021 Putting the mental back.txt",
  "Allen 2017 Aggression and Violence Definitions and distinctions.txt",
  "Yang et al. 2024 Impaired motor to sensory transformation mediates auditory hallucinations.txt",
  "Shimokura 2022 Sound Quality Factors Inducing the Autonomous Sensory Meridian Response.txt",
  "Guzick 2023 Clincial characteristics.txt",
  "Hume 2022 Physiological responses to and subjective estimates of soundscape elements.txt",
  "Zhang 2021 Individualism and nationally determined contributions to climate change.txt",
  "Wang 2022 Emotion Processes Predicting Outbursts and Functional Impact in Misophonia.txt",
  "Ruano 2025 From Misophonia through Puberphonia.txt",
  "Uglik-Marucha et al. (2023) Beyond sound irritation.txt",
  "BARAHMAND  2023 New York Misophonia Scale.txt",
  "Carter and Ellis 2025 Control  Resistance  and the Senses  Neurodivergent Perspectives of the UK School Meals Service  A Case Study.txt",
  "thieren-et-al-2Thieren 2024-new-hyperacusis-therapy-combines-psychoeducation-sound-exposure-and-counseling.txt",
  "Samermit 2022 Development and Evaluation of a Sound-Swapped Video Database for Misophonia.txt",
  "Shin 2022 Clinical findings that differentiate co-occurence of hyperacusis from tinnitus.txt",
  "Pfeiffer Elisa 2022 Misophonia in Children and Adolescents.txt",
  "Babalola 2024 Misophonia is associated with heightened emtion evocation by music PsyArXiv.txt",
  "Adnan 2023 Sensing Sound on the Skin a review of auitory tactile synesthesia.txt",
  "Turnhout 2020 the politics of coproduction participation, power, and transformation.txt",
  "Golonka 2025 Sensory processing sensitivity in adult dental patients.txt",
  "Meek 2023 Dissertation Sensory Processing.txt",
  "Bolton and Gillett 2019 The Biopsychosocial model of health and disease.txt",
  "Zumbrunn 2023 Investigating Sound Specific Attention Control.txt",
  "Ghorbani 2022 Effectiveness of online group mindfulness and acceptance based therapy.txt",
  "Williams 2022 Decreased sound Tolerance in autism understanding and distinguishing between hyperacusis, misophonia, and phonophobia.txt",
  "Muller 2018 Cognitive_Behavioral_Therapy_for_an_Adolescent Female Presesnting with Misophonia.txt",
  "Gladney 2024 Evaluation and Treatment of Central Auditory Processing and Sound.txt",
  "Pack 2019 The need for an ethics of sustainable knowledge production.txt",
  "Peer Review Comments Curation of Foams.txt",
  "Swedo et al. 2023 Consensus Defintion.txt",
  "Kim 2023 Speech in Noise performance in individuals with misophonia and hyperacusis.txt",
  "Brown 2014 Consciousness doesn_t overflow cognition.txt",
  "Rinaldi 2023 Mental Health Difficulties in Children who Develop Misophonia.txt",
  "Banker 2024 Neural and behavioral coputations of social interaction in autism and beyond.txt",
  "Manning  2025 Decreased Sound tolerance in a Canadian University Context.txt",
  "Casiello Robbins 2021  A Preliminary Investigation of the Association Between Misophonia and Symptoms of Psychopathology and Personality Disorders.txt",
  "simner 2024-an-automated-online-measure-for-misophonia-the-sussex-misophonia-scale-for-adults.txt",
  "Eijsker 2021 White Matter Abnormalities in misophonia.txt",
  "Bennett 2023 diagnostic uncertainty avoidant restrictive food intake disorder.txt",
  "Hansen 2021 What Sound sources trigger misophonia not just chewing and breathing.txt",
  "Bell 2020 Ethics, politics and embodied imagination in crafting scientific knowledge.txt",
  "Banker 2022 Disrupted computations of social control in individuals with obsessive-compulsive and misophonia symptoms.txt",
  "Palumbo 2018 Misophonia and Potential Underlying Mechanisms A Perspective.txt",
  "Aldine 2024 Assessment of working memory abilities people with and without misophonia.txt",
  "Rabani 2023 Detecting suicidality on social media machine learning at rescue.txt",
  "Mahmoud Dissertation 2024.txt",
  "Molenda 2024 Thought Contagion Conspiracy Beliefs Boost Paranoid Thoughts.txt",
  "Ash 2023 Mimicry in misophonia a large scale survey of prevalance and relationship with trigger sounds.txt",
  "Spencer 2023 Things that Make you go Hmmm Myths and misconceptions within cognitive behavioral treatment of obsessive compulsive disorder.txt",
  "Lodol 2024 Analyzing Sensory Gating MA Thesis.txt",
  "Tollefsrud 2020 Obsessed with Sound an investigation into misophonia and its relation to memory.txt",
  "Simmons (1997) Brain Mechanisms of Reality Monitoring.txt",
  "Pereira 2020 The role of sentience in the theory of consciousness.txt",
  "Lewin 2023 Clinical Characteristics of treatment seeking youth with misophonia.txt",
  "Mollman 2023 The central role of symptom severity and associated characteristics for functional impairment in misophonia.txt",
  "Guzick and Storch 2025 Chapter Six Sensory Dysregulation in OCD-Related Disorders.txt",
  "Schneebeli 2022 Disentanging Bayesian Brain theories of autism spectrum disorder.txt",
  "McGeoch 2020 How everyday sounds can trigger strong emotions ASMR, misophonia and the feeling of wellbeing.txt",
  "Peltola Henna-Riikka 2022 The Kind of Music that Makes my Skin Crawl.txt",
  "Langlo (2022) I Don_t think people really understand the seriousness.txt",
  "Black et al 2025 Misophonia symptoms severity is attributed to impaired flexibility and heightened rumination.txt",
  "Mashour 2020 Conscious Processing and the Global Neuronal Workspace Hypothesis.txt",
  "Bruxner 2016 Mastication Rage a review of misophonia.txt",
  "Silva page 68 0-Livro de Atas_CLTO_RACS_completo (1).txt",
  "Brout 2018 Investigating Misophonia A Review of the Emperical Literature, Clinical Implications, and a Research Agenda.txt",
  "Henry 2023 History of Tinnitus at VA.txt",
  "Rosenthal 2022 Treatment of Misophonia.txt",
  "Mecca Andrew 2022 cAMP and voltage modulate rat auditory mechanostransduction.txt",
  "Bodo 2024 Association between chronic misophonia-induced stress and gastrointestinel pathology in children.txt",
  "Mitova 2020 Explanatory Injustice and Epistemic Agency.txt",
  "Bahmei 2023 Misophonia Sound Recognition Using Vision Transformer.txt",
  "Mutlu 2023 Misophonia and its relationship with other psychiatric disorders.txt",
  "D Antoni 2021 Brainspotting reduces disturbance and increases heart rate variability linked to distressing memories.txt",
  "Cervin 2023 Measuring Misophonia in Youth.txt",
  "Colak 2021 Misophonic symptoms in non-psychotic psychiatric outpatients.txt",
  "Singer 2024 Undergraduate Honors Thesis An Exploration of Misophonia in the Literature.txt",
  "Wybrane-problemy-wspolczesnej-diagnostyki-klinicznej_2024.txt",
  "Hostler 2024 Research Priorities for Autonomous Sensory Meridian.txt",
  "Schroder 2014 Diminished N1 auditory.txt",
  "Dwyer et al 2025 A trans-diagnostic investigation of attention and diverse phenotypes of auditory hyperreactivity.txt",
  "Guetta 2022 Development and psychometric exploration of a semi-structured clinical interview for misophonia.txt",
  "Seth 2022 Theories of Consciousness.txt",
  "Mednicoff 2022 Auditory affective processing, musicaliyt, and the development of misophonic reactions.txt",
  "Pfeiffer 2023 The prevalence of misophonia in a representative population based survey in Germany.txt",
  "Jean Pamelo 2022 ACES a Test I wanted a low score on.txt",
  "Jastreboff 2018 Tinnitus and decreased sound tolerance.txt",
  "Almadani 2024 Prevalence_of_misophonia_and_its_association_with depression and OCD among medical students.txt",
  "Balachandar 2025 Misophonia in Tic Disorders and Their Neuropsychiatric Associations.txt",
  "Izmaylov 2022 Insight Essay.txt",
  "Remmert 2022 A Nomological Network for Misophonia.txt",
  "Vanukuri 2023 Misophonia Assessment on Individuals with various occupations.txt",
  "Hansen 2024 The Effect of Misophonia on Coginitive and Social justgements.txt",
  "Cuthbert 2015 Research Domain Criteria toward future psychiatric nosologies.txt",
  "Sheppard 2020 Right hemisphere ventral stream for emotional prosody identification.txt",
  "Enzler Falco 2021 A psychoacoustic test for misophonia.txt",
  "Chapman 2022 Reimagining the mental health paradigm for our collective well being.txt",
  "Brout 2022 A Brief Commentary on the Conesnsus Defintion.txt",
  "Mitchell 2024 State of the Science Disgust and the Anxiety Disorders.txt",
  "Schadegg Mary 2021 Evaluating Anxiety Sensitivity.txt",
  "Ash 2023  Dr Jekyll Had Misophonia_Preprint.txt",
  "Aazh 2022 Audiological and Other Factors Predicting the Presence of Misophonia Symptoms Among a Clinical Population Seeking Help for Tinnitus and or Hyperacusis.txt",
  "Webb and Keane 2022 MDMA for the treatment of misophonia a proposal.txt",
  "Rinaldi Louisa 2022 Poorer Well Being in Children with Misophoia Sussex Scale 2022.txt",
  "Gillmeister Helge 2022 Touching You Touching Me.txt",
  "Herdi and Yildirim 2024 Sex Specific Correlations Between Misophonia Symptoms and ADHD, OCD, and Autism Related Traits in Adolescent Outpatients.txt",
  "Almoril-Porrras et al 2025 Configuration of electrical synapses filters sensory information to drive behavior choices.txt",
  "Jaswal  and Handy 2024 is misokinesia explained by visual attentional orienting.txt",
  "Naylor 2021 The Prevalence adn Severity of Misophonia in a UK Undergraduate Medical Student population.txt",
  "Kula 2025 Evaluation of the psychometric properties of the English MisoQuest and its relationship with audiological and psychological factors.txt",
  "Robinson 2023 The lived experiences of people with misophonia v2 - Revised_SS.txt",
  "Prats 2024 Implementing the Reconsolidation Paradigm in Treating Misophonia.txt",
  "Kim 2023 The Effects of Autonomous Sensory Meridian Response on MOdality Mood and Mindfulness.txt",
  "Iskander   2023  Neurological_Underpinnings_of_Psychological Factors.txt",
  "Andermane 2023 A Phenomenological Cartography of Misophonia.txt",
  "Gupta 2024 Self and Else Living on the Receiving Ends of Misophonia.txt",
  "Storch 2023 Family Accommodations in Children and Adolescents with  Misophonia.txt",
  "Balan 2021 The Networked Computer Metaphor a Novel Tool for Psychiatric Trainees.txt",
  "poerio 2024-sensing-and-feeling-an-overview.txt",
  "Pohlhaus 2014 Discerning the Primary Epistemic Harm in Cases of Testimonial Injustice.txt",
  "Rabinow 1994 Foucault_Michel_Ethics_Subjectivity_and_Truth.txt",
  "Castillo-et-al-2024-psychometric-properties-of-a-self-perception-questionnaire-for-adults-with-suspected-misophonia.txt",
  "Lyre 2018 Socially Extended Cognition and Shared Intentionality.txt",
  "Larsen 2022 Preliminary validation of the Norwegian version of misophonia questionnaire MQ NOR.txt",
  "Vitoratou 2022 Evidence of Cross-Cultural Consistency of the S-Five Model for Misophonia Psychometric Conclusions Emerging From the Mandarin Version.txt",
  "Woolley Clinical characteristics of a treatment seeking sample of adults with misophonia.txt",
  "Bishop 2007 Foucauldian_Diagnostics_Space_Time_and_t.txt",
  "Vitoratou 2023 Misophonia in the UK Prevalence and norms from the S Five in a UK representative sample.txt",
  "Lane 2023 Tracing the Song of the Universe A Jungian Investigation of the Archetypal Aspects of Sound.txt",
  "Elden 2023 Foucault Before the College de France.txt",
  "Fayzullina 2016 23andMe White Paper.txt",
  "Bain 2024 A tutorial on supervised machine learning variable selection.txt",
  "Syed 2020 The role of the biopsychosocial model in public health.txt",
  "Oberman et al 2025 Human sounds and associated tonality disrupting.txt",
  "NISVSReportonIntimatePartnerViolence_2022.txt",
  "Frost and Lumia 2012 The Ethics of Neuroscience and the Neuroscience of Ethics.txt",
  "Adolphs 2010 Conceptual Challenges and Directions for Social Neuroscience.txt",
  "Michel 2019 consciousness science underdetermined a short history.txt",
  "Pollock 2007 The Performative I.txt",
  "Williams 2021 A Review of Decreased sound tolerance in Autism Defiitions, phenomenology, and potential mechanisms.txt",
  "Ciaunica A 2021 Back to Square One bodily role of consciousness.txt",
  "Dixon 2024 Prevalence, Phenomenology, and Impact of Misophonia.txt",
  "Brake 2024 My struggles are largely sensory.txt",
  "LeDoux 2020 Thoughtful Feelings.txt",
  "McMahon 2024 The unified protocol for transdiagnostic treatment of emotional disorders.txt",
  "Radoilska 2017  Circumstance, Answerabilitiy, and Luck.txt"
]


================================================================================


################################################################################
# File: netlify/functions/rag.js
################################################################################

// -----------------------------------------------------------------------------
//  Netlify Function  ·  Retrieval-Augmented Generation for Misophonia Companion
// -----------------------------------------------------------------------------
//  •  Embeds the query with OpenAI ada-002 (1536-D)
//  •  Vector search in Supabase via pgvector RPC
//  •  Client-side cosine re-rank (-100…+100  %)
//  •  Bibliography-only chunks are discarded
//  •  Prompt budget guard (≤ 24 000 chars)
//  •  GPT-4.1-mini-2025-04-14 writes a Markdown answer + Bibliography section
//  •  GET  /stats   → return total number of indexed chunks
//  •  POST /search  → return { answer, citations, results }
// -----------------------------------------------------------------------------
//  Environment variables required at *function* runtime:
//
//      SUPABASE_URL                 (e.g. https://xyz.supabase.co)
//      SUPABASE_SERVICE_ROLE_KEY    (or anon key if RLS permits the RPC)
//      OPENAI_API_KEY               (to embed + generate)
// -----------------------------------------------------------------------------
//  This file is a line-for-line port of rag_web_app_v9.py, rewritten in Node so
//  it can run natively as a Netlify Function (no external Flask server needed).
// -----------------------------------------------------------------------------
import 'dotenv/config';
import { createClient } from '@supabase/supabase-js';
import OpenAI from 'openai';

// ──────────────────────────── configuration ─────────────────────────────── //
const {
  SUPABASE_URL,
  SUPABASE_SERVICE_ROLE_KEY,
  OPENAI_API_KEY,
} = process.env;

if (!SUPABASE_URL || !SUPABASE_SERVICE_ROLE_KEY || !OPENAI_API_KEY) {
  throw new Error(
    '❌  Missing env vars: SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY, OPENAI_API_KEY'
  );
}

const sb     = createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY);
const openai = new OpenAI({ apiKey: OPENAI_API_KEY });

// ────────────────────────── embedding & similarity ───────────────────────── //
// In-memory LRU-ish cache (Map) so repeated identical queries in the same
// container instance don’t double-embed and waste tokens.
const embCache = new Map();

/** Return ada-002 embedding for *text* (1536-D float array) */
async function embed(text) {
  if (embCache.has(text)) return embCache.get(text);

  const { data } = await openai.embeddings.create({
    model: 'text-embedding-ada-002',
    input: text.slice(0, 8192), // hard limit: ada-002 max input tokens
  });

  const vec = data[0].embedding;
  embCache.set(text, vec);
  return vec;
}

/** Plain cosine similarity (no scaling) */
const cosine = (a, b) => {
  let dot = 0,
    na = 0,
    nb = 0;
  for (let i = 0; i < a.length; i++) {
    dot += a[i] * b[i];
    na  += a[i] * a[i];
    nb  += b[i] * b[i];
  }
  return dot / (Math.sqrt(na) * Math.sqrt(nb) + 1e-9); // avoid /0
};

// ─────────────────────── bibliography chunk detector ─────────────────────── //
const DOI_RE  = /\b10\.\d{4,9}\/[-._;()/:A-Z0-9]+\b/gi;
const YEAR_RE = /\b(19|20)\d{2}\b/g;

/** True if chunk looks like a pure references list (skip). */
const looksLikeRefs = (txt) =>
  (txt.match(DOI_RE)?.length || 0) > 12 ||
  (txt.match(YEAR_RE)?.length || 0) > 15;

// ────────────────────────────── vector search ────────────────────────────── //
/**
 * 1. Embed query
 * 2. pgvector RPC (over-fetch 4× so we can re-rank)
 * 3. Drop bibliography noise
 * 4. Pull true embeddings + doc metadata
 * 5. Client-side cosine re-rank (-100…+100 %)
 * 6. Return top *limit* rows
 */
async function semanticSearch(query, limit = 8, threshold = 0) {
  const qVec = await embed(query);

  const { data: rows = [] } = await sb.rpc('match_research_chunks', {
    query_embedding: qVec,
    match_threshold: threshold,  // 0 → ANN returns highest-IP matches
    match_count: limit * 4,      // over-fetch (will re-rank)
  });

  const filtered = rows.filter(r => !looksLikeRefs(r.text));
  if (!filtered.length) return [];

  // Bulk-fetch embeddings + document rows in 2 round-trips
  const chunkIds = filtered.map(r => r.id);
  const docIds   = [...new Set(filtered.map(r => r.document_id))];

  const [
    { data: embRows = [] },
    { data: docs    = [] },
  ] = await Promise.all([
    sb.from('research_chunks')
      .select('id,embedding')
      .in('id', chunkIds)
      .limit(chunkIds.length),
    sb.from('research_documents')
      .select(
        'id,title,authors,year,journal,doi,abstract,keywords,research_topics,source_pdf'
      )
      .in('id', docIds)
      .limit(docIds.length),
  ]);

  const embMap = new Map(
    embRows.map(e => [
      e.id,
      Array.isArray(e.embedding)
        ? e.embedding.map(Number)                       // numeric column
        : e.embedding.slice(1, -1).split(',').map(Number), // text column "[…]"
    ])
  );
  const docMap = new Map(docs.map(d => [d.id, d]));

  // Compute **true cosine** and attach metadata
  filtered.forEach(r => {
    const vec = embMap.get(r.id);
    r.similarity = vec ? Math.round(cosine(qVec, vec) * 1000) / 10 : 0; // –100…+100
    r.doc        = docMap.get(r.document_id) || {};
  });

  return filtered
    .sort((a, b) => b.similarity - a.similarity)
    .slice(0, limit);
}

// ────────────────────────── prompt-budget helper ─────────────────────────── //
const MAX_PROMPT_CHARS = 24_000; // 6 k tokens ≈ GPT-4o safety window

/** Drop low-similarity chunks until sum(text.length) ≤ MAX_PROMPT_CHARS */
function trimChunks(chunks) {
  let acc = 0;
  const out = [];
  for (const c of [...chunks].sort((a, b) => b.similarity - a.similarity)) {
    const len = c.text.length;
    if (acc + len > MAX_PROMPT_CHARS) break;
    out.push(c);
    acc += len;
  }
  return out;
}

// ────────────────────────── GPT-4 prompt builder ─────────────────────────── //
function buildPrompt(question, chunks) {
  const snippetLines = [];
  const biblioLines  = [];

  chunks.forEach((c, idx) => {
    snippetLines.push(
      `[${idx + 1}] "${c.text.trim()}" (pp. ${c.page_start}-${c.page_end})`
    );

    const d       = c.doc;
    const title   = d.title || 'Untitled';
    const authors = Array.isArray(d.authors) ? d.authors.join(', ') : d.authors;
    const journal = d.journal || 'Unknown journal';
    const year    = d.year || 'n.d.';
    const pages   = `pp. ${c.page_start}-${c.page_end}`;
    const doi     = d.doi ? `[doi:${d.doi}](https://doi.org/${d.doi})` : '';

    biblioLines.push(
      `[${idx + 1}] *${title}* · ${authors || 'Unknown'} · ${journal} (${year}) · ${pages} ${doi}`
    );
  });

  const prompt_parts = [
    'You are Misophonia Companion, a highly knowledgeable and empathetic AI assistant built to support clinicians, researchers, and individuals managing misophonia.',
    'You draw on evidence from peer-reviewed literature, clinical guidelines, and behavioral science.',
    'Your responses are clear, thoughtful, and grounded in the provided context.',
    '====',
    'QUESTION:',
    question,
    '====',
    'CONTEXT:',
    ...snippetLines,
    '====',
    'INSTRUCTIONS:',
    '• Write your answer in **Markdown**.',
    '• Begin with a concise summary (2–3 sentences).',
    '• Then elaborate on key points using well-structured paragraphs.',
    '• Provide relevant insights or suggestions (e.g., clinical, behavioral, emotional, or research-related).',
    '• If helpful, use lists, subheadings, or analogies to enhance understanding.',
    '• Use a professional and empathetic tone.',
    '• Cite sources inline like [1], [2] etc.',
    "• After the answer, include a 'BIBLIOGRAPHY:' section that lists each source exactly as provided below.",
    "• If none of the context answers the question, reply: \"I'm sorry, I don't have sufficient information to answer that.\"",
    '====',
    'BEGIN OUTPUT',
    'ANSWER:',
    '',                        // blank line – GPT populates here
    'BIBLIOGRAPHY:',
    ...biblioLines,
  ];

  return prompt_parts.join('\n');
}

// ───────────────────── citation extractor (for UI) ──────────────────────── //
const extractCitations = txt =>
  [...new Set((txt.match(/\[(\d+)]/g) || []).map(m => m.slice(1, -1)))];

// ──────────────────────────── main Lambda handler ───────────────────────── //
export async function handler(event) {
  try {
    // ── tiny ops endpoint: /stats ─────────────────────────────────────── //
    if (event.httpMethod === 'GET' && event.path.endsWith('/stats')) {
      const { count } = await sb
        .from('research_chunks')
        .select('id', { count: 'exact' })
        .limit(1);

      return {
        statusCode: 200,
        headers: { 'content-type': 'application/json' },
        body: JSON.stringify({ total_chunks: count }),
      };
    }

    // ── POST /search  (main RAG flow) ─────────────────────────────────── //
    if (event.httpMethod !== 'POST') {
      return { statusCode: 405, body: 'Method Not Allowed' };
    }

    const body  = JSON.parse(event.body || '{}');
    const query = (body.query || '').trim();
    const limit = body.limit ? Number(body.limit) : 8;

    if (!query) {
      return { statusCode: 400, body: 'Missing "query"' };
    }

    /* 1. Semantic retrieval */
    const rawMatches = await semanticSearch(query, limit);
    if (!rawMatches.length) {
      return {
        statusCode: 200,
        headers: { 'content-type': 'application/json' },
        body: JSON.stringify({
          answer:
            "I'm sorry, I don't have sufficient information to answer that.",
          citations: [],
          results: [],
        }),
      };
    }

    /* 2. Prompt construction */
    const chunks = trimChunks(rawMatches);
    const prompt = buildPrompt(query, chunks);

    /* 3. GPT-4 generation */
    const chat = await openai.chat.completions.create({
      model: 'gpt-4.1-mini-2025-04-14',
      messages: [{ role: 'user', content: prompt }],
      temperature: 0,
    });

    const answerText = chat.choices[0].message.content.trim();
    const citations  = extractCitations(answerText);

    /* 4. Remove heavy embedding vectors before returning to client */
    rawMatches.forEach(m => delete m.embedding);

    return {
      statusCode: 200,
      headers: { 'content-type': 'application/json' },
      body: JSON.stringify({ answer: answerText, citations, results: rawMatches }),
    };
  } catch (err) {
    // Any failure (OpenAI, Supabase, JSON parse) → 500
    console.error('RAG λ failed →', err);
    return {
      statusCode: 500,
      headers: { 'content-type': 'application/json' },
      body: JSON.stringify({ error: String(err) }),
    };
  }
}


================================================================================


################################################################################
# File: scripts/resilient_batch_embedding_generator_gian_v1.1.py
################################################################################

# File: scripts/resilient_batch_embedding_generator_gian_v1.1.py

#!/usr/bin/env python3
###############################################################################
###############################################################################
"""
Resilient Batch Embedding Generator — Supabase edition (token‑safe v3‑fix)
==========================================================================

• Pulls rows from `research_chunks` whose `embedding` is NULL
  **and** `chunking_strategy = 'token_window'`.
• Uses the *actual* token count stored in each row, so even weird
  `/C111/C102/…` glyph dumps are handled correctly.
• Sends slices that respect both:
      – a *row* cutoff (`--commit`, default 100) and
      – the model's 8 192‑token limit (we stop at ≤ 8 000).
• UPSERTs vectors back to Supabase and writes a JSON run‑report.

Environment
-----------
SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY, OPENAI_API_KEY  must be set.
"""

from __future__ import annotations

import argparse
import json
import logging
import os
import sys
import time
from datetime import datetime
from typing import Any, Dict, List

from dotenv import load_dotenv
from openai import OpenAI
from supabase import create_client
from tqdm import tqdm

# ───────────────────────────── configuration ────────────────────────────── #

load_dotenv()

SUPABASE_URL  = os.getenv("SUPABASE_URL")
SUPABASE_KEY  = os.getenv("SUPABASE_SERVICE_ROLE_KEY")
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

EMBEDDING_MODEL  = "text-embedding-ada-002"

MODEL_TOKEN_LIMIT = 8_192         # model hard limit
TOKEN_GUARD       = 200           # safety margin
MAX_TOTAL_TOKENS  = MODEL_TOKEN_LIMIT - TOKEN_GUARD   # 8 000

DEFAULT_BATCH_ROWS  = 5_000       # rows fetched from Supabase per outer loop
DEFAULT_COMMIT_ROWS = 100         # max rows per single OpenAI request

MAX_RETRIES = 5
RETRY_DELAY = 2                   # seconds between retries

openai_client = OpenAI(api_key=OPENAI_API_KEY)

logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s — %(levelname)s — %(message)s",
)
log = logging.getLogger(__name__)

# ───────────────────────────── Supabase helpers ─────────────────────────── #

def init_supabase():
    if not SUPABASE_URL or not SUPABASE_KEY:
        log.error("SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY not set.")
        sys.exit(1)
    return create_client(SUPABASE_URL, SUPABASE_KEY)


def count_processed_chunks(sb) -> int:
    res = (
        sb.table("research_chunks")
        .select("id", count="exact")
        .not_.is_("embedding", "null")
        .execute()
    )
    return res.count or 0


def fetch_unprocessed_chunks(
    sb, *, limit: int, offset: int = 0
) -> List[Dict[str, Any]]:
    """
    Grab up to *limit* rows whose embedding IS NULL.
    We also fetch token_start/end so we can trust the real token length.
    """
    first, last = offset, offset + limit - 1          # PostgREST uses inclusive range
    res = (
        sb.table("research_chunks")
        .select("id,text,token_start,token_end")
        .eq("chunking_strategy", "token_window")
        .is_("embedding", "null")
        .range(first, last)
        .execute()
    )
    return res.data or []

# ───────────────────────────  OpenAI interaction  ───────────────────────── #

def generate_embedding_batch(texts: List[str]) -> List[List[float]]:
    attempt = 0
    while attempt < MAX_RETRIES:
        try:
            resp = openai_client.embeddings.create(
                model=EMBEDDING_MODEL,
                input=texts,
            )
            return [d.embedding for d in resp.data]
        except Exception as exc:
            attempt += 1
            log.warning("Embedding batch %s/%s failed: %s",
                        attempt, MAX_RETRIES, exc)
            time.sleep(RETRY_DELAY)
    raise RuntimeError("OpenAI embedding batch failed after retries")

# ───────────────────────── token‑safe slicing helpers ────────────────────── #

def chunk_tokens(row: Dict[str, Any]) -> int:
    """
    Return the best‑guess token length for a chunk.

    Priority:
    1.  Use token_end – token_start + 1  *if present and plausible*.
        (Some PDFs have token_end values that balloon into 80‑90 k range;
         we treat anything 0 < t ≤ 16 384 as plausible.)
    2.  Fallback: estimate by words × 0.75, which is roughly the OpenAI
        tokenizer ratio for English prose.  Cap to the model limit so we
        never falsely mark a chunk as oversize.
    """
    try:
        t = int(row["token_end"]) - int(row["token_start"]) + 1
        if 0 < t <= 16_384:        # sane bound (2× GPT‑4o context)
            return t
    except Exception:
        pass

    txt = row.get("text", "") or ""
    approx = int(len(txt.split()) * 0.75) + 1
    return min(max(1, approx), MODEL_TOKEN_LIMIT)   # never exceed limit


def safe_slices(
    rows: List[Dict[str, Any]],
    max_rows: int,
) -> List[List[Dict[str, Any]]]:
    """
    Break *rows* into slices obeying BOTH limits:
        • len(slice) ≤ max_rows
        • Σ tokens(slice) ≤ MAX_TOTAL_TOKENS
    """
    slices: List[List[Dict[str, Any]]] = []
    current: List[Dict[str, Any]] = []
    cur_tokens = 0

    for r in rows:
        txt = (r.get("text") or "").replace("\x00", "")
        if not txt.strip():
            continue

        t = chunk_tokens(r)

        if t > MAX_TOTAL_TOKENS:
            log.warning("Chunk %s is > %s tokens — skipping.", r["id"], MAX_TOTAL_TOKENS)
            continue

        need_new_slice = (
            len(current) >= max_rows or
            cur_tokens + t > MAX_TOTAL_TOKENS
        )
        if need_new_slice and current:
            slices.append(current)
            current = []
            cur_tokens = 0

        current.append({"id": r["id"], "text": txt})
        cur_tokens += t

    if current:
        slices.append(current)
    return slices


def embed_slice(sb, slice_rows: List[Dict[str, Any]]) -> int:
    """Generate embeddings for *slice_rows* and UPSERT them back. Returns #rows updated."""
    embeds = generate_embedding_batch([r["text"] for r in slice_rows])
    ok = 0
    for row, emb in zip(slice_rows, embeds):
        attempt = 0
        while attempt < MAX_RETRIES:
            res = (
                sb.table("research_chunks")
                .update({"embedding": emb})
                .eq("id", row["id"])
                .execute()
            )
            if getattr(res, "error", None):
                attempt += 1
                log.warning("Update %s failed (%s/%s): %s",
                            row["id"], attempt, MAX_RETRIES, res.error)
                time.sleep(RETRY_DELAY)
            else:
                ok += 1
                break
    return ok

# ────────────────────────────────── main ────────────────────────────────── #

def main() -> None:
    ap = argparse.ArgumentParser(
        description="Embed research_chunks where embedding IS NULL (token‑safe)"
    )
    ap.add_argument("--batch-size", type=int, default=DEFAULT_BATCH_ROWS,
                    help="rows fetched from Supabase per outer loop (default 5000)")
    ap.add_argument("--commit", type=int, default=DEFAULT_COMMIT_ROWS,
                    help="row‑cutoff per single OpenAI request (default 100)")
    ap.add_argument("--skip", type=int, default=0,
                    help="row offset for pagination / parallel runs")
    ap.add_argument("--model", default=EMBEDDING_MODEL,
                    help="override embedding model name")
    ap.add_argument("--model-limit", type=int, default=MODEL_TOKEN_LIMIT,
                    help="override model token limit (hard max context)")
    args = ap.parse_args()

    # allow quick overrides without editing the file
    global EMBEDDING_MODEL, MODEL_TOKEN_LIMIT, MAX_TOTAL_TOKENS
    EMBEDDING_MODEL   = args.model
    MODEL_TOKEN_LIMIT = args.model_limit
    MAX_TOTAL_TOKENS  = MODEL_TOKEN_LIMIT - TOKEN_GUARD

    if not OPENAI_API_KEY:
        log.error("OPENAI_API_KEY not set.")
        sys.exit(1)

    sb = init_supabase()
    log.info("Rows already embedded: %s", count_processed_chunks(sb))

    loop = 0
    total_embedded = 0
    while True:
        loop += 1
        rows = fetch_unprocessed_chunks(sb, limit=args.batch_size, offset=args.skip)
        if not rows:
            log.info("✨  Done — no more rows needing embeddings.")
            break

        log.info("Loop %s — fetched %s rows needing embeddings.", loop, len(rows))
        slices = safe_slices(rows, args.commit)
        log.info("Created %s token‑safe OpenAI requests.", len(slices))

        for sl in tqdm(slices, desc=f"Embedding loop {loop}", unit="batch"):
            try:
                total_embedded += embed_slice(sb, sl)
            except Exception as exc:
                log.error("Slice failed: %s", exc)

        log.info("Loop %s complete – total embedded so far: %s", loop, total_embedded)

    # -------------  JSON report  ------------- #
    ts = datetime.utcnow().strftime("%Y%m%d_%H%M%S")
    report = {
        "timestamp": ts,
        "batch_size": args.batch_size,
        "commit": args.commit,
        "skip": args.skip,
        "total_embedded": total_embedded,
        "total_with_embeddings": count_processed_chunks(sb),
    }
    fname = f"supabase_embedding_report_{ts}.json"
    with open(fname, "w") as fp:
        json.dump(report, fp, indent=2)
    log.info("Report saved to %s", fname)


if __name__ == "__main__":        # pragma: no cover
    main()


================================================================================


################################################################################
# File: server/index.js
################################################################################

import express from 'express';
import cors from 'cors';
import dotenv from 'dotenv';
import { OpenAI } from 'openai';
import fetch from 'node-fetch';
import httpProxy from 'http-proxy';

dotenv.config();

// Set AI provider here - "openai" or "gemini"
const AI_PROVIDER = process.env.AI_PROVIDER || "openai";

const app = express();

//app.use(cors());  --> This is the default behavior
app.use(cors({
  origin: [
    '[https://misophonia-guide.netlify.app](https://misophonia-guide.netlify.app)',
    'http://localhost:5173'
  ]
}));
app.use(express.json());

const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });

// Research Assistant endpoint (handles both Gemini and OpenAI)
app.post('/api/gemini', async (req, res) => {
  try {
    const { messages, topic } = req.body;
    
    if (!messages || !Array.isArray(messages)) {
      return res.status(400).json({ error: 'Messages array required.' });
    }
    
    // Using OpenAI
    if (AI_PROVIDER === "openai") {
      // Format messages for OpenAI
      const systemPrompt = topic 
        ? `You are a knowledgeable research assistant focusing on the topic: ${topic}. Provide information about misophonia research.`
        : "You are a knowledgeable research assistant on misophonia research.";
      
      const openaiMessages = [
        { role: 'system', content: systemPrompt },
        ...messages
      ];
      
      const completion = await openai.chat.completions.create({
        model: 'gpt-4o',
        messages: openaiMessages,
        max_tokens: 1024,
        temperature: 0.7
      });
      
      return res.json({
        reply: completion.choices[0]?.message?.content || '',
        structured: null,
        provider: 'openai'
      });
    }
    
    // Using Gemini
    else {
      const apiKey = process.env.GEMINI_API_KEY;
      if (!apiKey) {
        return res.status(500).json({ error: 'GEMINI_API_KEY not set in server/.env.' });
      }
      
      // Compose prompt for Gemini
      let userPrompt = '';
      if (topic && typeof topic === 'string') {
        userPrompt += `Topic: ${topic}\n`;
      }
      userPrompt += messages.map(m => `${m.role === 'user' ? 'User' : 'Assistant'}: ${m.content}`).join('\n');
      
      // Gemini API call
      const geminiRes = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro-preview-03-25:generateContent?key=' + apiKey, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ role: 'user', parts: [{ text: userPrompt }] }],
          generationConfig: {
            temperature: 0.7,
            maxOutputTokens: 1024,
          },
          tools: [
            { "function_declarations": [
              { "name": "structured_output", "description": "Return information in a structured JSON format for chat display, with sections, bullet points, and highlights." }
            ]}
          ]
        })
      });
      
      if (!geminiRes.ok) {
        const err = await geminiRes.text();
        return res.status(500).json({ error: 'Error from Gemini API', details: err });
      }
      
      const geminiData = await geminiRes.json();
      // Parse structured output if present
      let structured = null;
      if (geminiData.candidates && geminiData.candidates[0]?.content?.parts) {
        const part = geminiData.candidates[0].content.parts[0];
        if (part.functionCall && part.functionCall.name === 'structured_output') {
          try {
            structured = JSON.parse(part.functionCall.args.json || '{}');
          } catch {
            structured = part.functionCall.args;
          }
        }
      }
      
      return res.json({
        reply: geminiData.candidates?.[0]?.content?.parts?.[0]?.text || '',
        structured,
        provider: 'gemini'
      });
    }
  } catch (error) {
    console.error(error);
    res.status(500).json({ error: `Error from ${AI_PROVIDER === "openai" ? "OpenAI" : "Gemini"} API.` });
  }
});

// Keep existing OpenAI chat endpoint
app.post('/api/chat', async (req, res) => {
  try {
    const { messages } = req.body;
    if (!messages || !Array.isArray(messages)) {
      return res.status(400).json({ error: 'Messages array required.' });
    }
    const completion = await openai.chat.completions.create({
      model: 'gpt-4o',
      messages,
      max_tokens: 512,
      temperature: 0.7
    });
    const reply = completion.choices[0]?.message?.content || '';
    res.json({ reply });
  } catch (error) {
    console.error(error);
    res.status(500).json({ error: 'Error from OpenAI API.' });
  }
});

// ───────────────────────── RAG proxy ─────────────────────────
const proxy = httpProxy.createProxyServer({ changeOrigin: true });

app.post('/api/rag', (req, res) => {
  proxy.web(req, res, { target: 'http://localhost:8080/search' }, err => {
    console.error(err);
    res.status(502).json({ error: 'RAG service unreachable' });
  });
});

const PORT = process.env.PORT || 3001;
app.listen(PORT, () => {
  console.log(`Server running with ${AI_PROVIDER.toUpperCase()} on port ${PORT}`);
});


================================================================================


################################################################################
# File: scripts/migrate_to_supabase.js
################################################################################

import fs from 'fs';
import path from 'path';
import admin from 'firebase-admin';
import { createClient } from '@supabase/supabase-js';
import dotenv from 'dotenv';

// Load environment variables
dotenv.config({ path: path.resolve(process.cwd(), 'server/.env') });

// Initialize Firebase Admin SDK (source)
const serviceAccount = {
  projectId: process.env.FIREBASE_PROJECT_ID,
  clientEmail: process.env.FIREBASE_CLIENT_EMAIL,
  privateKey: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g, '\n'),
};
admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
});
const db = admin.firestore();

// Initialize Supabase (destination)
const supabase = createClient(
  process.env.SUPABASE_URL || '',
  process.env.SUPABASE_ANON_KEY || ''
);

// Export Firestore data
async function exportFirestoreData() {
  console.log('Exporting data from Firestore...');
  
  const chunks = await db.collection('research_chunks').get();
  const data = chunks.docs.map(doc => ({
    id: doc.id,
    ...doc.data(),
    // Convert Firestore timestamp to ISO string
    created_at: doc.data().createdAt?.toDate().toISOString()
  }));
  
  fs.writeFileSync('chunks_export.json', JSON.stringify(data));
  console.log(`Exported ${data.length} documents to chunks_export.json`);
  return data;
}

// Import to Supabase
async function importToSupabase(data) {
  console.log('Importing data to Supabase...');
  
  // Insert in batches
  const BATCH_SIZE = 500;
  for (let i = 0; i < data.length; i += BATCH_SIZE) {
    const batch = data.slice(i, i + BATCH_SIZE);
    
    console.log(`Importing batch ${Math.floor(i/BATCH_SIZE) + 1}/${Math.ceil(data.length/BATCH_SIZE)}...`);
    
    // Prepare records for Supabase
    const records = batch.map(item => {
      // Remove Firestore-specific fields and rename fields to match Supabase schema
      const { createdAt, embedding, ...rest } = item;
      return {
        ...rest,
        // Use created_at from previous conversion or current date
        created_at: item.created_at || new Date().toISOString()
      };
    });
    
    const { error } = await supabase
      .from('research_chunks')
      .insert(records);
    
    if (error) {
      console.error('Error importing batch:', error);
    } else {
      console.log(`Successfully imported batch ${Math.floor(i/BATCH_SIZE) + 1}`);
    }
  }
  
  console.log('Import completed!');
}

// Main function
async function main() {
  try {
    // Check if export file exists
    if (fs.existsSync('chunks_export.json')) {
      console.log('Using existing export file: chunks_export.json');
      const data = JSON.parse(fs.readFileSync('chunks_export.json'));
      await importToSupabase(data);
    } else {
      const data = await exportFirestoreData();
      await importToSupabase(data);
    }
  } catch (error) {
    console.error('Migration failed:', error);
  }
}

main().catch(console.error);


================================================================================


################################################################################
# File: js-requirements.md
################################################################################

################################################################################
################################################################################
# JavaScript Dependencies for Misophonia Research RAG System

## Core Dependencies

```json
{
  "dependencies": {
    "dotenv": "^16.0.3",
    "fast-glob": "^3.3.3",
    "firebase": "^10.0.0",
    "firebase-admin": "^11.8.0",
    "mammoth": "^1.9.0",
    "node-fetch": "^3.3.1",
    "openai": "^4.9.0",
    "pdfjs-dist": "^3.7.107",
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "axios": "^1.4.0",
    "body-parser": "^1.20.2"
  }
}
```

## Development Dependencies

```json
{
  "devDependencies": {
    "@eslint/js": "^9.22.0",
    "@types/react": "^19.0.10",
    "@types/react-dom": "^19.0.4",
    "@vitejs/plugin-react": "^4.3.4",
    "eslint": "^9.22.0",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.19",
    "globals": "^16.0.0",
    "netlify-cli": "^13.2.2",
    "vite": "^6.3.1",
    "vite-plugin-pwa": "^1.0.0"
  }
}
```

## Firebase-specific Dependencies

```json
{
  "dependencies": {
    "firebase/app": "included in firebase package",
    "firebase/firestore": "included in firebase package",
    "firebase/functions": "included in firebase package",
    "firebase-admin/app": "included in firebase-admin package",
    "firebase-admin/firestore": "included in firebase-admin package",
    "firebase-functions": "^4.3.0"
  }
}
```

## Installation Instructions

1. These dependencies are already defined in your project's `package.json` file.
2. To install all dependencies, run:
   ```
   npm install
   ```
3. For Firebase Cloud Functions, navigate to the functions directory and run:
   ```
   cd functions
   npm install
   ```

## Notes

- The Firebase client and admin SDKs are separate packages with different use cases:
  - `firebase` is for client-side applications
  - `firebase-admin` is for server-side applications and has elevated privileges

- For the RAG system, the key dependencies are:
  - `openai`: For generating embeddings and AI responses
  - `firebase-admin`: For accessing Firestore vector database
  - `pdfjs-dist`: For processing PDF documents
  - `express`: For the web server interface


================================================================================


################################################################################
# File: vite.config.js
################################################################################

import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import { VitePWA } from 'vite-plugin-pwa'

// https://vite.dev/config/
export default defineConfig({
  plugins: [
    react(),
    VitePWA({
      registerType: 'autoUpdate',
      workbox: {
        runtimeCaching: [
          {
            urlPattern: /^\/api\/(chat|gemini|rag).*$/,
            handler: 'NetworkOnly',
          },
        ],
      },
      manifest: {
        name: 'Misophonia Companion',
        short_name: 'Companion',
        description: 'A therapeutic and research PWA for misophonia.',
        start_url: '.',
        display: 'standalone',
        background_color: '#f8f6ff',
        theme_color: '#b2d8d8',
        icons: [
          {
            src: 'icon-192.png',
            sizes: '192x192',
            type: 'image/png'
          },
          {
            src: 'icon-512.png',
            sizes: '512x512',
            type: 'image/png'
          }
        ]
      }
    })
  ],
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:3001',
        changeOrigin: true,
      }
    }
  },
  build: {
    rollupOptions: {
      output: {
        manualChunks: undefined,
      },
    },
  },
  define: {
    __APP_BUILD_TIME__: JSON.stringify(Date.now()),
  },
})


================================================================================


################################################################################
# File: package.json
################################################################################

{
  "name": "misophonia-companion",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview",
    "link": "npx netlify link",
    "env:import": "npx netlify env:import server/.env",
    "deploy": "npx netlify deploy --prod --dir=dist",
    "ingest": "node scripts/ingest.js"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.39.0",
    "dotenv": "^16.0.3",
    "firebase-admin": "^11.8.0",
    "http-proxy": "^1.18.1",
    "node-fetch": "^3.3.1",
    "openai": "^4.9.0",
    "pdfjs-dist": "^3.7.107",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "vite-plugin-pwa": "^1.0.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.22.0",
    "@types/react": "^19.0.10",
    "@types/react-dom": "^19.0.4",
    "@vitejs/plugin-react": "^4.3.4",
    "eslint": "^9.22.0",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.19",
    "globals": "^16.0.0",
    "netlify-cli": "^13.2.2",
    "vite": "^6.3.1"
  }
}


================================================================================


################################################################################
# File: public/manifest.json
################################################################################

################################################################################
# File: public/manifest.json
################################################################################
{
  "name": "Misophonia Companion",
  "short_name": "Companion",
  "description": "A therapeutic and research PWA for misophonia.",
  "start_url": ".",
  "display": "standalone",
  "background_color": "#f8f6ff",
  "theme_color": "#b2d8d8",
  "icons": [
    {
      "src": "icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}


================================================================================


################################################################################
# File: server/package.json
################################################################################

{
  "name": "misophonia-companion-server",
  "version": "1.0.0",
  "main": "index.js",
  "type": "module",
  "scripts": {
    "start": "node index.js"
  },
  "dependencies": {
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "express": "^4.18.2",
    "openai": "^4.27.0",
    "@supabase/supabase-js": "^2.39.0"
  }
}


================================================================================

